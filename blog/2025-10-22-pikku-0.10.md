---
title: Pikku 0.10 â€” Smart Tree-Shaking and AI-Assisted Development
description: Pikku 0.10 delivers production-ready tree-shaking with service aggregation, a revolutionized CLI framework, and major middleware improvements.
draft: true
---

Pikku 0.10 represents a massive leap in **production readiness** and **developer experience**. This release focuses on **intelligent tree-shaking** that dramatically reduces bundle sizes, a revolutionized CLI framework, and major middleware improvements.

> tl;dr: smaller bundles via service aggregation, CLI-over-Channel streaming, and middleware factories with metadata.

<!-- truncate -->

---

## ğŸ¯ Intelligent Tree-Shaking: Only Bundle What You Use

Pikku 0.10 introduces **service aggregation** â€” a sophisticated tree-shaking system that analyzes your entire codebase to determine exactly which services are actually used.

### How It Works

The CLI now tracks service usage across:
- Functions themselves
- Middleware chains
- Permission guards
- Session factories
- Tag-based registrations

```bash
# Generate optimized bundle with service tracking
pikku --tags 'web,api' --types 'http,channel'
```

The result? **Dramatically smaller bundles** with only the services you actually need.

### Service Map Generation

```typescript
// Generated service map
export const serviceMap = {
  logger: true,
  database: true,
  jwt: true,
  // email: false - not used, excluded from bundle
  // s3: false - not used, excluded from bundle
}
```

This enables **lazy loading** of optional services:

```typescript
if (singletonServices.email) {
  const { EmailService } = await import('@my-app/email')
  email = new EmailService(config)
}
```

### Advanced Filtering

Wildcard and name-based filtering for precise control:

```bash
# Include only admin and API routes
pikku --tags 'admin,api'

# Exclude edge-incompatible functions
pikku --exclude-tags 'server-only'

# Filter by function name patterns
pikku --names 'user*,auth*'
```

ğŸ“š **[Learn more â†’ CLI Filtering](https://pikku.dev/docs/cli/filtering)**

---

## âš¡ CLI Framework Revolution

The CLI has been completely rewritten for 0.10 with streaming, RPC support, and channel execution.

### CLI-over-Channel

Execute CLI commands over WebSocket connections:

```typescript
import { executeChannelCLI } from '@pikku/core/cli'

// Client sends CLI command over WebSocket
await executeChannelCLI({
  channel,
  command: ['user', 'list', '--format', 'json'],
  singletonServices
})

// Server streams output back
channel.on('message', (output) => {
  console.log(output) // Progressive rendering
})
```

### RPC-Based Execution

CLI commands are now Pikku functions, enabling:
- **Type safety** for all commands
- **Middleware** and **permissions** support
- **Local or remote** execution
- **Streaming output** via channels

```typescript
export const listUsers = pikkuCLICommand({
  func: async ({ logger, userService }, { format }) => {
    const users = await userService.list()
    if (format === 'json') return JSON.stringify(users)
    return users.map(u => u.email).join('\n')
  },
  options: {
    format: { type: 'string', choices: ['json', 'text'] }
  }
})
```

### Renderer Tracking

CLI output is now validated and tracked:

```typescript
// CLI renderer in services
export const cliRenderer = pikkuCLIRenderer({
  renderHelp: (help) => console.log(help),
  renderOutput: (output) => console.log(output),
  renderError: (error) => console.error(error)
})
```

ğŸ“š **[Learn more â†’ CLI](https://pikku.dev/docs/cli)**

---

## ğŸ” Middleware & Permissions Evolution

### Factory Pattern with Metadata

Middleware and permissions now support **factories** with **optional metadata**:

```typescript
export const requireRole = pikkuMiddlewareFactory<{ role: string }>({
  name: 'requireRole',
  description: 'Enforce user role requirement',
  func: ({ role }) => async (services, interaction, next) => {
    if (services.session.role !== role) {
      throw new UnauthorizedError(`Requires ${role} role`)
    }
    return next()
  }
})

// Usage
wireHTTP({
  route: '/admin',
  middleware: [requireRole({ role: 'admin' })]
})
```

### Permission Factories

```typescript
export const canEditResource = pikkuPermissionFactory<{
  resourceType: string
}>({
  name: 'canEditResource',
  description: 'Check if user can edit resource',
  func: ({ resourceType }) => async (services, data, session) => {
    const resource = await services.db.get(resourceType, data.id)
    return resource.ownerId === session.userId
  }
})
```

### Tag Validation

Critical error logging for invalid tags:

```typescript
// Warns if tags don't match registered middleware/permissions
addMiddleware(['admin', 'typo-tag'], [middleware])
// Error: Tag 'typo-tag' not found in registered middleware
```

---

## ğŸ¨ Developer Experience Improvements

### React-Style Error Codes

Errors now include documentation codes:

```typescript
throw new PikkuError('PIKKU_001', 'Invalid configuration')
// Links to: https://pikku.dev/errors/PIKKU_001
```

### MCP URI Validation

Compile-time validation for Model Context Protocol resources:

```typescript
wireMCPResource({
  uri: 'user/{userId}/posts/{postId}', // Validated at build time
  func: getPost
})
```

### Type Safety Everywhere

- CLI option defaults are type-checked
- Channel `send()` is covariant (type-safe)
- `PikkuFunctionConfig` replaces raw functions in all APIs

---

## âš™ï¸ Performance Optimizations

### Caching System

- **Middleware resolution** cached at startup
- **Permission lookups** cached per route
- **HTTP meta** converted to Map (faster lookups)

### Smaller Bundles

- Split type generation (one file per wiring)
- Only import functions used by RPCs
- Tree-shakeable service dependencies

### Router Refactoring

Router is now **externally swappable** (like Hono), though the public API isn't exposed yet. Foundation is in place for pluggable routing strategies in 0.11.

---

## ğŸ”„ Breaking Changes

### API Renames

- `addMiddleware` â†’ `addHTTPMiddleware` (route support)
- `APIMiddleware` â†’ `PikkuMiddleware`
- `PikkuFunction` â†’ `PikkuFunctionConfig`
- `pikkuCLIOptions` â†’ `pikkuCLICommand`
- `PikkuPermission` â†’ `pikkuPermission` (consistency)

### Structure Changes

- RPC directories merged: `rpc-internal` + `rpc` â†’ `rpc`
- Application types: `application-types.js` â†’ `applications-types.d.js`
- Bootstrap imports use queue subdirectory for workers

### Middleware Changes

- Now uses factory pattern with `pikkuMiddlewareFactory`
- Positionals and options merged in CLI data handling
- EventHub service requires namespace parameter

ğŸ“š **[Migration Guide â†’ 0.9 to 0.10](https://pikku.dev/docs/migration/0.9-to-0.10)**

---

## ğŸš€ What's Next

Pikku 0.10 sets the foundation for:

- **Pluggable routers** (choose your routing strategy)
- **Enhanced MCP support** (OAuth, notifications)
- **Documentation expansion** (tutorials, examples)

---

## ğŸ™Œ Try It Now

Pikku 0.10 represents months of production hardening, developer experience improvements, and architectural refinements. **Intelligent tree-shaking** makes this the most production-ready Pikku release yet.

- ğŸ§ª **[Get Started](https://pikku.dev/docs/quickstart)**
- ğŸ’» **[View on GitHub](https://github.com/vramework/pikku)**
- ğŸ’¬ **[Join the conversation](https://github.com/vramework/pikku/discussions)**

Thanks for building with Pikku.

â€” Yasser
